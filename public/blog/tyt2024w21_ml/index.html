<!DOCTYPE html>
<html lang="en" dir="ltr"><head>
  
                           
     


<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.98.0" />
<title>TyT2024W21 - ML:Carbon Majors Emissions Data | Johanie Fournier</title>


<meta property="twitter:site" content="@fournierjohanie">
<meta property="twitter:creator" content="@fournierjohanie">







  
    
  
<meta name="description" content="Freelance Agronomist Doing Data Analysis">


<meta property="og:site_name" content="Johanie Fournier">
<meta property="og:title" content="TyT2024W21 - ML:Carbon Majors Emissions Data | Johanie Fournier">
<meta property="og:description" content="Freelance Agronomist Doing Data Analysis" />
<meta property="og:type" content="page" />
<meta property="og:url" content="https://johaniefournier.com/blog/tyt2024w21_ml/" />
<meta property="og:locale" content="en">




    
        <meta property="og:image" content="https://johaniefournier.com/blog/tyt2024w21_ml/featured.png" >
        <meta property="twitter:card" content="summary_large_image">
        <meta name="twitter:image" content="https://johaniefournier.com/blog/tyt2024w21_ml/featured.png" >
    
    
  <meta itemprop="name" content="TyT2024W21 - ML:Carbon Majors Emissions Data">
<meta itemprop="description" content="This week we&rsquo;re exploring historical emissions data from Carbon Majors. They have complied a database of emissions data going back to 1854. In this second part, I&rsquo;m predicting carbon emission over space and time."><meta itemprop="datePublished" content="2024-10-25T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-10-25T00:00:00+00:00" />
<meta itemprop="wordCount" content="1736"><meta itemprop="image" content="https://johaniefournier.com/blog/tyt2024w21_ml/featured.png">
<meta itemprop="keywords" content="rstats,tidymodels,tidytuesday,models," />
  
<script async src="https://www.googletagmanager.com/gtag/js?id=G-K3765H3YGW"></script>
<script>
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-K3765H3YGW', { 'anonymize_ip': true });
}
</script>

  
<script type="application/javascript">
var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
var doNotTrack = (dnt == "1" || dnt == "yes");
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-K3765H3YGW', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <!--[if IE]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <link rel="shortcut icon" href="/img/icon.png" type="image/x-icon">
  <link rel="icon" href="/img/icon.png" type="image/x-icon">
  
  
  <link rel="stylesheet" href="/style.main.min.3e7a26cb4247ffea6d23e69795ed2666ea212de564f2266ac96ed47b4ee5b931.css" integrity="sha256-Pnomy0JH/&#43;ptI&#43;aXle0mZuohLeVk8iZqyW7Ue07luTE=" media="screen">
  
  
  <script src="/panelset.min.8f4cba0107356728f266d94a12a4d18ef504eda8a9a284cda73675bae7884a68.js" type="text/javascript"></script>
  
  
  <script src="/main.min.5c2a34ae6659865a008a6856c3d0035205be131e5a950ccb863e57f6a76d4b1c.js" type="text/javascript"></script>
</head>
<body>
      <div class="grid-container">
<header class="site-header pt4 pb2 mb4 bb b--transparent ph5 headroom z-max" role="banner">
  <nav class="site-nav db dt-l w-100" role="navigation">
    <a class="site-brand db dtc-l v-mid link no-underline w-100 w-33-l tc tl-l" href="https://johaniefournier.com/" title="Home">
      <img src="/img/icon.png" class="dib db-l h2 w-auto" alt="Johanie Fournier">
    </a>
    <div class="site-links db dtc-l v-mid w-100 w-47-l tc tr-l mt3 mt0-l ttu tracked">
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/about/" title="About me">About</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 active" href="/blog/" title="Blog">Blog</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/categories/eda/" title="eda">eda</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/categories/viz/" title="viz">viz</a>
      
        
        
        
      <a class="link f6 f5-l dib pv1 ph2 " href="/categories/models/" title="models">models</a>
      
      
    </div>
  </nav>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7674504334497845"
     crossorigin="anonymous"></script>
</header>

<main class="page-main pa4" role="main">
  <section class="page-content mw7 center">
    <article class="post-content pa0 ph4-l">
      <header class="post-header">
        <h1 class="f1 lh-solid measure-narrow mb3 fw4">TyT2024W21 - ML:Carbon Majors Emissions Data</h1>
        
        <p class="f6 measure lh-copy mv1">By Johanie Fournier, agr., M.Sc. in <a href="https://johaniefournier.com/categories/rstats">rstats</a>  <a href="https://johaniefournier.com/categories/tidymodels">tidymodels</a>  <a href="https://johaniefournier.com/categories/tidytuesday">tidytuesday</a>  <a href="https://johaniefournier.com/categories/models">models</a> </p>
        <p class="f7 db mv0 ttu">October 25, 2024</p>

      

      </header>
      <section class="post-body pt5 pb4">
        <link href="index_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="index_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="index_files/libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="index_files/libs/datatables-binding-0.33/datatables.js"></script>
<script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="index_files/libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="index_files/libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="index_files/libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="index_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="index_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<p>
<a href="https://subscribepage.io/E3ia1B" target="_blank" rel="noopener"><img src="petit.png" alt=""></a></p>
<p>Subscribe button</p>
<br>
<p>This is my latest contribution to the 
<a href="https://github.com/rfordatascience/tidytuesday" target="_blank" rel="noopener"><code>#TidyTuesday</code> dataset</a> project, featuring a recent dataset on carbon major emissions.</p>
<p>In the 
<a href="https://www.johaniefournier.com/blog/tyt2024w21_eda/" target="_blank" rel="noopener">firs part</a>, the goal was to do some Exploratory Data Analysis (EDA). To do so, I looked at the data structure, anomalies, outliers and relationships to ensure I have everithing I need for this second part.</p>
<p>In this second part, I will be predicting carbon emissions over space and time. I will be using machine learning techniques to predict future emissions based on historical data. I will be using the <code>spdep</code> package to create a spatial weights matrix, and the <code>modeltime</code> package to train machine learning models and make predictions for future emissions. Let&rsquo;s get started!</p>
<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube-nocookie.com/embed/3xoz262R-qM" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>




<h2 id="data-preprocessing">Data Preprocessing
  <a href="#data-preprocessing"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>The first step here is to add the GPS coordinate for all th 50 <em>parent_entity</em> in the dataset. To do so, we first need to find the headquarters location for each company.</p>




<h3 id="get-headquarters-location">Get Headquarters Location
  <a href="#get-headquarters-location"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Load the data</span>
</span></span><span style="display:flex;"><span>data<span style="color:#666">&lt;-</span><span style="color:#06287e">read_rds</span>(<span style="color:#4070a0">&#34;data/final_data.rds&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#06287e">head</span>(data)
</span></span></code></pre></div><pre><code># A tibble: 6 × 3
  parent_entity_fct              date       observed
  &lt;fct&gt;                          &lt;date&gt;        &lt;dbl&gt;
1 Abu Dhabi National Oil Company 1962-10-24    0.498
2 Abu Dhabi National Oil Company 1963-10-24    1.05 
3 Abu Dhabi National Oil Company 1964-10-24    4.17 
4 Abu Dhabi National Oil Company 1965-10-24    6.19 
5 Abu Dhabi National Oil Company 1966-10-24    7.56 
6 Abu Dhabi National Oil Company 1967-10-24    8.00 
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>parent_entity<span style="color:#666">&lt;-</span>data<span style="color:#666">|&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">mutate</span>(parent_entity <span style="color:#666">=</span> <span style="color:#06287e">as.character</span>(parent_entity_fct))<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">select</span>(parent_entity)<span style="color:#666">|&gt;</span>  
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">unique</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DT<span style="color:#666">::</span><span style="color:#06287e">datatable</span>(parent_entity)
</span></span></code></pre></div><div class="datatables html-widget html-fill-item" id="htmlwidget-70558b9a35fa22c3f121" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-70558b9a35fa22c3f121">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50"],["Abu Dhabi National Oil Company","Alpha Metallurgical Resources","Anglo American","Arch Resources","BHP","BP","British Coal Corporation","Chevron","China (Cement)","China (Coal)","CNPC","Coal India","ConocoPhillips","CONSOL Energy","Czechoslovakia","Eni","Equinor","ExxonMobil","Former Soviet Union","Gazprom","Glencore","Iraq National Oil Company","Kazakhstan","Kuwait Petroleum Corp.","Libya National Oil Corp.","Lukoil","National Iranian Oil Co.","Nigerian National Petroleum Corp.","Occidental Petroleum","ONGC India","Peabody Coal Group","Pemex","Pertamina","Petrobras","Petroleos de Venezuela","Petronas","Poland","QatarEnergy","Repsol","Rio Tinto","Rosneft","Russian Federation","RWE","Sasol","Saudi Aramco","Shell","Sonatrach","Surgutneftegas","TotalEnergies","Ukraine"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>parent_entity<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"parent_entity","targets":1}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">pandas</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">pd</span>
</span></span><span style="display:flex;"><span><span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Load data</span>
</span></span><span style="display:flex;"><span>data <span style="color:#666">=</span> r<span style="color:#666">.</span>parent_entity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Function to get headquarters from Wikidata</span>
</span></span><span style="display:flex;"><span><span style="color:#007020;font-weight:bold">def</span> <span style="color:#06287e">get_wikidata_headquarters</span>(company):
</span></span><span style="display:flex;"><span>    <span style="color:#007020;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#60a0b0;font-style:italic"># Search for the company in Wikidata</span>
</span></span><span style="display:flex;"><span>        search_url <span style="color:#666">=</span> <span style="color:#4070a0">f</span><span style="color:#4070a0">&#34;https://www.wikidata.org/w/api.php?action=wbsearchentities&amp;search=</span><span style="color:#70a0d0;font-style:italic">{</span>company<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">&amp;language=en&amp;format=json&#34;</span>
</span></span><span style="display:flex;"><span>        search_response <span style="color:#666">=</span> requests<span style="color:#666">.</span>get(search_url)<span style="color:#666">.</span>json()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#007020;font-weight:bold">if</span> search_response[<span style="color:#4070a0">&#39;search&#39;</span>]:
</span></span><span style="display:flex;"><span>            <span style="color:#60a0b0;font-style:italic"># Get the Wikidata ID of the first search result</span>
</span></span><span style="display:flex;"><span>            wikidata_id <span style="color:#666">=</span> search_response[<span style="color:#4070a0">&#39;search&#39;</span>][<span style="color:#40a070">0</span>][<span style="color:#4070a0">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#60a0b0;font-style:italic"># Get detailed information from Wikidata using the ID</span>
</span></span><span style="display:flex;"><span>            entity_url <span style="color:#666">=</span> <span style="color:#4070a0">f</span><span style="color:#4070a0">&#34;https://www.wikidata.org/wiki/Special:EntityData/</span><span style="color:#70a0d0;font-style:italic">{</span>wikidata_id<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.json&#34;</span>
</span></span><span style="display:flex;"><span>            entity_response <span style="color:#666">=</span> requests<span style="color:#666">.</span>get(entity_url)<span style="color:#666">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#60a0b0;font-style:italic"># Extract the headquarters location</span>
</span></span><span style="display:flex;"><span>            entity_data <span style="color:#666">=</span> entity_response[<span style="color:#4070a0">&#39;entities&#39;</span>]<span style="color:#666">.</span>get(wikidata_id, {})
</span></span><span style="display:flex;"><span>            claims <span style="color:#666">=</span> entity_data<span style="color:#666">.</span>get(<span style="color:#4070a0">&#39;claims&#39;</span>, {})
</span></span><span style="display:flex;"><span>            headquarters_claim <span style="color:#666">=</span> claims<span style="color:#666">.</span>get(<span style="color:#4070a0">&#39;P159&#39;</span>, [])
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#007020;font-weight:bold">if</span> headquarters_claim:
</span></span><span style="display:flex;"><span>                <span style="color:#60a0b0;font-style:italic"># Get the headquarters location label</span>
</span></span><span style="display:flex;"><span>                location_id <span style="color:#666">=</span> headquarters_claim[<span style="color:#40a070">0</span>][<span style="color:#4070a0">&#39;mainsnak&#39;</span>][<span style="color:#4070a0">&#39;datavalue&#39;</span>][<span style="color:#4070a0">&#39;value&#39;</span>][<span style="color:#4070a0">&#39;id&#39;</span>]
</span></span><span style="display:flex;"><span>                location_url <span style="color:#666">=</span> <span style="color:#4070a0">f</span><span style="color:#4070a0">&#34;https://www.wikidata.org/wiki/Special:EntityData/</span><span style="color:#70a0d0;font-style:italic">{</span>location_id<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">.json&#34;</span>
</span></span><span style="display:flex;"><span>                location_response <span style="color:#666">=</span> requests<span style="color:#666">.</span>get(location_url)<span style="color:#666">.</span>json()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                location_data <span style="color:#666">=</span> location_response[<span style="color:#4070a0">&#39;entities&#39;</span>]<span style="color:#666">.</span>get(location_id, {})
</span></span><span style="display:flex;"><span>                location_label <span style="color:#666">=</span> location_data[<span style="color:#4070a0">&#39;labels&#39;</span>]<span style="color:#666">.</span>get(<span style="color:#4070a0">&#39;en&#39;</span>, {})<span style="color:#666">.</span>get(<span style="color:#4070a0">&#39;value&#39;</span>, <span style="color:#4070a0">&#39;Unknown&#39;</span>)
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#007020;font-weight:bold">return</span> location_label
</span></span><span style="display:flex;"><span>        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#4070a0">&#39;Headquarters not found&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#007020;font-weight:bold">except</span> <span style="color:#007020">Exception</span> <span style="color:#007020;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#007020;font-weight:bold">return</span> <span style="color:#4070a0">f</span><span style="color:#4070a0">&#39;Error: </span><span style="color:#70a0d0;font-style:italic">{</span><span style="color:#007020">str</span>(e)<span style="color:#70a0d0;font-style:italic">}</span><span style="color:#4070a0">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Assuming &#39;data&#39; is your dataframe and &#39;parent_entity&#39; is the column containing company names</span>
</span></span><span style="display:flex;"><span>data[<span style="color:#4070a0">&#39;headquarters&#39;</span>] <span style="color:#666">=</span> data[<span style="color:#4070a0">&#39;parent_entity&#39;</span>]<span style="color:#666">.</span>apply(get_wikidata_headquarters)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Display the updated dataframe</span>
</span></span><span style="display:flex;"><span>data<span style="color:#666">.</span>head()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Complete missing headquarters</span>
</span></span><span style="display:flex;"><span>headquarters<span style="color:#666">&lt;-</span>py<span style="color:#666">$</span>data <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">as.data.frame</span>() <span style="color:#666">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">mutate</span>(headquarters<span style="color:#666">=</span><span style="color:#06287e">case_when</span>(
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Alpha Metallurgical Resources&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Bristol, Tennessee, États-Unis&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;BHP&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Melbourne, Ausralie&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;BP&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Londres, Royaume-Uni&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;British Coal Corporation&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Hobart House, Grosvenor Place, London&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Chevron&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;San Ramon, Californie, États-Unis&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;China (Cement)&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;China&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;China (Coal)&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Beijing, Chine&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Czechoslovakia&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Czech Republic&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Eni&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Rpme, Italie&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Former Soviet Union&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Moscou, Russie&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Kazakhstan&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Astana, Kazakhstan&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Kuwait Petroleum Corp.&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Kuwait City, Koweït&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Libya National Oil Corp.&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Tripoli, Libye&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;National Iranian Oil Co.&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Tehran, Iran&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Nigerian National Petroleum Corp.&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Abuja, Nigeria&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;ONGC India&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;India&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Peabody Coal Group&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Saint-Louis, Missouri, États-Unis&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Poland&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Poland&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Russian Federation&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Russie&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Shell&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Londres, Royaume-Uni&#34;</span>,
</span></span><span style="display:flex;"><span>    parent_entity<span style="color:#666">==</span><span style="color:#4070a0">&#34;Ukraine&#34;</span> <span style="color:#666">~</span> <span style="color:#4070a0">&#34;Ukraine&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#007020;font-weight:bold">TRUE</span> <span style="color:#666">~</span> headquarters
</span></span><span style="display:flex;"><span>  ))
</span></span></code></pre></div>



<h3 id="get-gps-coordinates">Get GPS Coordinates
  <a href="#get-gps-coordinates"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Now that we have the headquarters locations, we can extract the GPS coordinates for each location using the <code>ggmap</code> package.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#Get GPS coordinate with ggmap</span>
</span></span><span style="display:flex;"><span>ggmap<span style="color:#666">::</span><span style="color:#06287e">register_google</span>(<span style="color:#4070a0">&#34;Insert_your_key_here&#34;</span>)
</span></span><span style="display:flex;"><span>geocoded_data<span style="color:#666">&lt;-</span>ggmap<span style="color:#666">::</span><span style="color:#06287e">geocode</span>(headquarters<span style="color:#666">$</span>headquarters) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">bind_cols</span>(headquarters) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">drop_na</span>()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">write_rds</span>(geocoded_data, <span style="color:#4070a0">&#34;data/geocoded_data.rds&#34;</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#Load my data</span>
</span></span><span style="display:flex;"><span>geocoded_data<span style="color:#666">&lt;-</span><span style="color:#06287e">read_rds</span>(<span style="color:#4070a0">&#34;data/geocoded_data.rds&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#06287e">head</span>(geocoded_data)
</span></span></code></pre></div><pre><code># A tibble: 6 × 4
      lon   lat parent_entity                  headquarters                  
    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                          &lt;chr&gt;                         
1  54.4    24.5 Abu Dhabi National Oil Company Abu Dhabi                     
2 -82.2    36.6 Alpha Metallurgical Resources  Bristol, Tennessee, États-Unis
3  -0.128  51.5 Anglo American                 London                        
4 -90.2    38.6 Arch Resources                 St. Louis                     
5 145.    -37.8 BHP                            Melbourne, Ausralie           
6  -0.128  51.5 BP                             Londres, Royaume-Uni          
</code></pre>
<p>Let&rsquo;s put it all together!</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>data_final<span style="color:#666">&lt;-</span>data <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">mutate</span>(parent_entity <span style="color:#666">=</span> <span style="color:#06287e">as.character</span>(parent_entity_fct)) <span style="color:#666">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">right_join</span>(geocoded_data, by<span style="color:#666">=</span><span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;parent_entity&#34;</span>)) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">select</span>(<span style="color:#666">-</span>parent_entity_fct, <span style="color:#666">-</span>headquarters) 
</span></span></code></pre></div>



<h3 id="create-a-spatial-weights-matrix">Create a Spatial Weights Matrix
  <a href="#create-a-spatial-weights-matrix"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>We need some spatial information extracted from the coordinate to put into the temporal model. We will use the GPS coordinates to create a k-nearest neighbors spatial weights matrix. This matrix will be used as spatial information of the observed emissions, which will be used as a predictor in the machine learning models.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Extract coordinates</span>
</span></span><span style="display:flex;"><span>coords <span style="color:#666">&lt;-</span> data_final <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">select</span>(lon, lat)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Create k-nearest neighbors spatial weights matrix (example with k = 4)</span>
</span></span><span style="display:flex;"><span>knn <span style="color:#666">&lt;-</span> spdep<span style="color:#666">::</span><span style="color:#06287e">knearneigh</span>(coords, k <span style="color:#666">=</span> <span style="color:#40a070">4</span>, longlat <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span>nb <span style="color:#666">&lt;-</span> spdep<span style="color:#666">::</span><span style="color:#06287e">knn2nb</span>(knn)
</span></span><span style="display:flex;"><span>listw_knn <span style="color:#666">&lt;-</span> spdep<span style="color:#666">::</span><span style="color:#06287e">nb2listw</span>(nb, style <span style="color:#666">=</span> <span style="color:#4070a0">&#34;W&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Compute spatial lag using the weights matrix</span>
</span></span><span style="display:flex;"><span>spatial_lag <span style="color:#666">&lt;-</span> spdep<span style="color:#666">::</span><span style="color:#06287e">lag.listw</span>(listw_knn, data_final<span style="color:#666">$</span>observed)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Add the spatial lag</span>
</span></span><span style="display:flex;"><span>data_spatial <span style="color:#666">&lt;-</span> data_final <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">mutate</span>(spatial_lag <span style="color:#666">=</span> spatial_lag) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">select</span>(<span style="color:#666">-</span>lon, <span style="color:#666">-</span>lat)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>top6_entity<span style="color:#666">&lt;-</span>data_spatial <span style="color:#666">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">select</span>(parent_entity) <span style="color:#666">|&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">unique</span>() <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#06287e">top_n</span>(<span style="color:#40a070">6</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data_spatial <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">group_by</span>(parent_entity) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">filter</span>(parent_entity <span style="color:#666">%in%</span> top6_entity<span style="color:#666">$</span>parent_entity) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">plot_time_series</span>(date, observed,
</span></span><span style="display:flex;"><span>                     .facet_ncol <span style="color:#666">=</span> <span style="color:#40a070">2</span>,
</span></span><span style="display:flex;"><span>                     .smooth <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>, 
</span></span><span style="display:flex;"><span>                     .interactive <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>)
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-10-1.png" width="1260" />




<h2 id="modeling">Modeling
  <a href="#modeling"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Now that we have the spatial information, we can start training machine learning models to predict future emissions. We will use the <code>modeltime</code> package to train and evaluate the models.</p>




<h3 id="extend-nesting-and-splitting-data">Extend, Nesting and Splitting Data
  <a href="#extend-nesting-and-splitting-data"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>First, we need to extend the time series data to include future observations for the next 20 years, then nest the data by the parent entity, and finally split the data into training and testing sets.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>nested_data_tbl <span style="color:#666">&lt;-</span> data_spatial<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">group_by</span>(parent_entity)<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#60a0b0;font-style:italic">#Extend</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">extend_timeseries</span>(
</span></span><span style="display:flex;"><span>        .id_var <span style="color:#666">=</span> parent_entity,
</span></span><span style="display:flex;"><span>        .date_var <span style="color:#666">=</span> date,
</span></span><span style="display:flex;"><span>        .length_future <span style="color:#666">=</span> <span style="color:#40a070">20</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#60a0b0;font-style:italic">#Nest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">nest_timeseries</span>(
</span></span><span style="display:flex;"><span>        .id_var <span style="color:#666">=</span> parent_entity,
</span></span><span style="display:flex;"><span>        .length_future <span style="color:#666">=</span> <span style="color:#40a070">20</span>
</span></span><span style="display:flex;"><span>    )<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#60a0b0;font-style:italic">#Split</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">split_nested_timeseries</span>(
</span></span><span style="display:flex;"><span>        .length_test <span style="color:#666">=</span> <span style="color:#40a070">20</span>
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div>



<h3 id="model-training">Model training
  <a href="#model-training"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Next, we will train machine learning models to predict future emissions. We will train two XGBoost models with different learning rates and a Temporal Hierarchical Forecasting (THief) model.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Recipe</span>
</span></span><span style="display:flex;"><span>rec_xgb <span style="color:#666">&lt;-</span> <span style="color:#06287e">recipe</span>(observed <span style="color:#666">~</span> ., <span style="color:#06287e">extract_nested_train_split</span>(nested_data_tbl)) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">step_timeseries_signature</span>(date) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">step_rm</span>(date) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">step_zv</span>(<span style="color:#06287e">all_predictors</span>()) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">step_dummy</span>(<span style="color:#06287e">all_nominal_predictors</span>(), one_hot <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Models </span>
</span></span><span style="display:flex;"><span>wflw_xgb_1 <span style="color:#666">&lt;-</span> <span style="color:#06287e">workflow</span>()<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_model</span>(<span style="color:#06287e">boost_tree</span>(<span style="color:#4070a0">&#34;regression&#34;</span>, learn_rate <span style="color:#666">=</span> <span style="color:#40a070">0.35</span>)<span style="color:#666">|&gt;</span>  <span style="color:#06287e">set_engine</span>(<span style="color:#4070a0">&#34;xgboost&#34;</span>))<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_recipe</span>(rec_xgb)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wflw_xgb_2 <span style="color:#666">&lt;-</span> <span style="color:#06287e">workflow</span>()<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_model</span>(<span style="color:#06287e">boost_tree</span>(<span style="color:#4070a0">&#34;regression&#34;</span>, learn_rate <span style="color:#666">=</span> <span style="color:#40a070">0.50</span>)<span style="color:#666">|&gt;</span>  <span style="color:#06287e">set_engine</span>(<span style="color:#4070a0">&#34;xgboost&#34;</span>))<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_recipe</span>(rec_xgb)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wflw_thief <span style="color:#666">&lt;-</span> <span style="color:#06287e">workflow</span>()<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_model</span>(<span style="color:#06287e">temporal_hierarchy</span>()<span style="color:#666">|&gt;</span>  <span style="color:#06287e">set_engine</span>(<span style="color:#4070a0">&#34;thief&#34;</span>))<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">add_recipe</span>(<span style="color:#06287e">recipe</span>(observed <span style="color:#666">~</span> ., <span style="color:#06287e">extract_nested_train_split</span>(nested_data_tbl)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Nested Modeling</span>
</span></span><span style="display:flex;"><span><span style="color:#06287e">parallel_start</span>(<span style="color:#40a070">6</span>)
</span></span><span style="display:flex;"><span>nested_modeltime_tbl <span style="color:#666">&lt;-</span> nested_data_tbl<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">modeltime_nested_fit</span>(
</span></span><span style="display:flex;"><span>        model_list <span style="color:#666">=</span> <span style="color:#06287e">list</span>(
</span></span><span style="display:flex;"><span>            wflw_xgb_1,
</span></span><span style="display:flex;"><span>            wflw_xgb_2,
</span></span><span style="display:flex;"><span>            wflw_thief
</span></span><span style="display:flex;"><span>        ),
</span></span><span style="display:flex;"><span>        control <span style="color:#666">=</span> <span style="color:#06287e">control_nested_fit</span>(
</span></span><span style="display:flex;"><span>            verbose   <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>,
</span></span><span style="display:flex;"><span>            allow_par <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span></code></pre></div>



<h3 id="review-errors">Review Errors
  <a href="#review-errors"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Before selecting the best model, we need to review any errors that occurred during the training process. We will also check the accuracy of the models and investigate any anomalies.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># #1) list errors</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># errors&lt;-nested_modeltime_tbl|&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#   extract_nested_error_report()</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># #2) Spot too high accuracy</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># nested_modeltime_tbl |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     extract_nested_test_accuracy() |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     table_modeltime_accuracy()</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># #3) Investigate</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># nested_modeltime_tbl|&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     filter(parent_entity == &#34;Lukoil&#34;) |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     extract_nested_train_split()</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># nested_modeltime_tbl|&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     extract_nested_test_forecast() |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     filter(parent_entity == &#34;Former Soviet Union&#34;) |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     group_by(parent_entity) |&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#     plot_modeltime_forecast(.facet_ncol = 3,</span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#                             .interactive = FALSE)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">#4) remove small time series</span>
</span></span><span style="display:flex;"><span>ids_small_timeseries <span style="color:#666">&lt;-</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;Lukoil&#34;</span>, <span style="color:#4070a0">&#34;Rosneft&#34;</span>, <span style="color:#4070a0">&#34;Glencore&#34;</span>,<span style="color:#4070a0">&#34;Surgutneftegas&#34;</span>, <span style="color:#4070a0">&#34;Ukraine&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nested_modeltime_subset_tbl <span style="color:#666">&lt;-</span> nested_modeltime_tbl<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">filter</span>(<span style="color:#666">!</span>parent_entity <span style="color:#666">%in%</span> ids_small_timeseries)
</span></span></code></pre></div>



<h3 id="select-best-models">Select Best Models
  <a href="#select-best-models"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Next, we will select the best models based on the root mean square error (RMSE) metric. We will visualize the best models to compare their performance and identify any anomalies.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>nested_best_tbl <span style="color:#666">&lt;-</span> nested_modeltime_subset_tbl<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">modeltime_nested_select_best</span>(metric <span style="color:#666">=</span> <span style="color:#4070a0">&#34;rmse&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nested_best_tbl <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">extract_nested_test_forecast</span>() <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">filter</span>(parent_entity <span style="color:#666">%in%</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;CONSOL Energy&#34;</span>, <span style="color:#4070a0">&#34;Shell&#34;</span>, <span style="color:#4070a0">&#34;Former Soviet Union&#34;</span>, <span style="color:#4070a0">&#34;Anglo American&#34;</span>,<span style="color:#4070a0">&#34;Chevron&#34;</span>,<span style="color:#4070a0">&#34;BP&#34;</span>)) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">group_by</span>(parent_entity) <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">plot_modeltime_forecast</span>(.facet_ncol <span style="color:#666">=</span> <span style="color:#40a070">2</span>, 
</span></span><span style="display:flex;"><span>                            .legend_show <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>,
</span></span><span style="display:flex;"><span>                            .interactive <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>)
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-14-1.png" width="1260" />




<h3 id="refit-models">Refit Models
  <a href="#refit-models"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h3>
<p>Finally, we will refit the best models on the entire dataset to make predictions for future emissions. We will also review any errors that occurred during the refitting process and visualize the future forecasts for the selected companies.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Refit</span>
</span></span><span style="display:flex;"><span>nested_best_refit_tbl <span style="color:#666">&lt;-</span> nested_best_tbl<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">modeltime_nested_refit</span>(
</span></span><span style="display:flex;"><span>        control <span style="color:#666">=</span> <span style="color:#06287e">control_refit</span>(
</span></span><span style="display:flex;"><span>            verbose   <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>,
</span></span><span style="display:flex;"><span>            allow_par <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">TRUE</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Error last check</span>
</span></span><span style="display:flex;"><span>nested_best_refit_tbl<span style="color:#666">|&gt;</span>  <span style="color:#06287e">extract_nested_error_report</span>()
</span></span></code></pre></div><pre><code># A tibble: 5 × 4
  parent_entity                 .model_id .model_desc .error_desc               
  &lt;chr&gt;                             &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                     
1 Alpha Metallurgical Resources        NA NULL        No method for an object o…
2 CNPC                                 NA NULL        No method for an object o…
3 Gazprom                              NA NULL        No method for an object o…
4 Kazakhstan                           NA NULL        No method for an object o…
5 Russian Federation                   NA NULL        No method for an object o…
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># Visualize Future Forecast </span>
</span></span><span style="display:flex;"><span>nested_best_refit_tbl<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">extract_nested_future_forecast</span>()<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">filter</span>(parent_entity <span style="color:#666">%in%</span> <span style="color:#06287e">c</span>(<span style="color:#4070a0">&#34;CONSOL Energy&#34;</span>, <span style="color:#4070a0">&#34;Shell&#34;</span>, <span style="color:#4070a0">&#34;Former Soviet Union&#34;</span>, <span style="color:#4070a0">&#34;Anglo American&#34;</span>,<span style="color:#4070a0">&#34;Chevron&#34;</span>,<span style="color:#4070a0">&#34;BP&#34;</span>))<span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">group_by</span>(parent_entity)<span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">plot_modeltime_forecast</span>(.facet_ncol <span style="color:#666">=</span> <span style="color:#40a070">2</span>, 
</span></span><span style="display:flex;"><span>                            .legend_show <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>,
</span></span><span style="display:flex;"><span>                            .interactive <span style="color:#666">=</span> <span style="color:#007020;font-weight:bold">FALSE</span>)
</span></span></code></pre></div><img src="index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-15-1.png" width="1260" />




<h2 id="save-preds">Save preds
  <a href="#save-preds"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>Finally, we will save the predictions for future emissions to a file for further analysis and visualization.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>nested_best_refit_tbl <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">extract_nested_future_forecast</span>() <span style="color:#666">|&gt;</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#06287e">write_rds</span>(<span style="color:#4070a0">&#34;data/data_with_pred.rds&#34;</span>)
</span></span></code></pre></div>



<h2 id="conclusion">Conclusion
  <a href="#conclusion"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<p>In this post, I have shown how to predict carbon emissions over space and time using the Carbon Majors dataset. I have demonstrated how to preprocess the data, create a spatial weights matrix, and train machine learning models to predict future emissions. I have also shown how to evaluate the model&rsquo;s performance and make predictions for future emissions. This is just one example of how machine learning can be used to analyze environmental data and make predictions about future trends. I hope this post has been helpful and informative, and that it has inspired you to explore the Carbon Majors dataset further and apply machine learning techniques to other environmental datasets.</p>




<h1 id="sign-up-for-the-newsletter">Sign up for the newsletter
  <a href="#sign-up-for-the-newsletter"></a>
</h1>
<p>
<a href="https://dashboard.mailerlite.com/forms/1478852/152663752035010469/share" target="_blank" rel="noopener"><img src="sign_up.png" alt=""></a></p>
<p>Sign up</p>




<h2 id="session-info">Session Info
  <a href="#session-info"><svg class="anchor-symbol" aria-hidden="true" height="26" width="26" viewBox="0 0 22 22" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0h24v24H0z" fill="currentColor"></path>
      <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76.0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71.0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71.0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76.0 5-2.24 5-5s-2.24-5-5-5z"></path>
    </svg></a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#06287e">sessionInfo</span>()
</span></span></code></pre></div><pre><code>R version 4.4.2 (2024-10-31)
Platform: aarch64-apple-darwin20
Running under: macOS Sequoia 15.5

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Toronto
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices datasets  utils     methods   base     

other attached packages:
 [1] jofou.lib_0.0.0.9000 reticulate_1.40.0    tidytuesdayR_1.1.2  
 [4] tictoc_1.2.1         terra_1.8-10         sf_1.0-19           
 [7] pins_1.4.0           modeltime_1.3.1      fs_1.6.5            
[10] timetk_2.9.0         yardstick_1.3.2      workflowsets_1.1.0  
[13] workflows_1.1.4      tune_1.2.1           rsample_1.2.1       
[16] parsnip_1.2.1        modeldata_1.4.0      infer_1.0.7         
[19] dials_1.3.0          scales_1.3.0         broom_1.0.7         
[22] tidymodels_1.2.0     recipes_1.1.0        doFuture_1.0.1      
[25] future_1.34.0        foreach_1.5.2        skimr_2.1.5         
[28] forcats_1.0.0        stringr_1.5.1        dplyr_1.1.4         
[31] purrr_1.0.2          readr_2.1.5          tidyr_1.3.1         
[34] tibble_3.2.1         ggplot2_3.5.1        tidyverse_2.0.0     
[37] lubridate_1.9.4      kableExtra_1.4.0     inspectdf_0.0.12.1  
[40] openxlsx_4.2.7.1     knitr_1.49          

loaded via a namespace (and not attached):
  [1] wk_0.9.4            rstudioapi_0.17.1   jsonlite_1.8.9     
  [4] magrittr_2.0.3      farver_2.1.2        rmarkdown_2.29     
  [7] vctrs_0.6.5         spdep_1.3-10        base64enc_0.1-3    
 [10] blogdown_1.20       htmltools_0.5.8.1   progress_1.2.3     
 [13] xgboost_1.7.8.1     s2_1.1.7            spData_2.3.4       
 [16] sass_0.4.9          parallelly_1.41.0   StanHeaders_2.32.10
 [19] KernSmooth_2.23-26  bslib_0.8.0         htmlwidgets_1.6.4  
 [22] cachem_1.1.0        zoo_1.8-12          ggfittext_0.10.2   
 [25] igraph_2.1.4        lifecycle_1.0.4     iterators_1.0.14   
 [28] pkgconfig_2.0.3     Matrix_1.7-2        R6_2.5.1           
 [31] fastmap_1.2.0       digest_0.6.37       colorspace_2.1-1   
 [34] furrr_0.3.1         crosstalk_1.2.1     labeling_0.4.3     
 [37] timechange_0.3.0    compiler_4.4.2      proxy_0.4-27       
 [40] doParallel_1.0.17   withr_3.0.2         backports_1.5.0    
 [43] DBI_1.2.3           MASS_7.3-64         lava_1.8.1         
 [46] rappdirs_0.3.3      classInt_0.4-11     tools_4.4.2        
 [49] units_0.8-5         zip_2.3.1           future.apply_1.11.3
 [52] nnet_7.3-20         anomalize_0.3.0     glue_1.8.0         
 [55] grid_4.4.2          generics_0.1.3      gtable_0.3.6       
 [58] tzdb_0.4.0          class_7.3-23        data.table_1.16.4  
 [61] hms_1.1.3           sp_2.1-4            xml2_1.3.6         
 [64] utf8_1.2.4          pillar_1.10.1       splines_4.4.2      
 [67] lhs_1.2.0           lattice_0.22-6      deldir_2.0-4       
 [70] renv_1.0.7          survival_3.8-3      tidyselect_1.2.1   
 [73] svglite_2.1.3       xfun_0.50           hardhat_1.4.0      
 [76] timeDate_4041.110   DT_0.33             stringi_1.8.4      
 [79] boot_1.3-31         DiceDesign_1.10     yaml_2.3.10        
 [82] evaluate_1.0.3      codetools_0.2-20    cli_3.6.3          
 [85] RcppParallel_5.1.10 rpart_4.1.24        systemfonts_1.2.1  
 [88] repr_1.1.7          munsell_0.5.1       jquerylib_0.1.4    
 [91] Rcpp_1.0.14         globals_0.16.3      png_0.1-8          
 [94] parallel_4.4.2      gower_1.0.2         prettyunits_1.2.0  
 [97] GPfit_1.0-8         listenv_0.9.1       viridisLite_0.4.2  
[100] ipred_0.9-15        xts_0.14.1          prodlim_2024.06.25 
[103] e1071_1.7-16        crayon_1.5.3        rlang_1.1.5        
</code></pre>

        
        <details closed class="f6 fw7 input-reset">
  <dl class="f6 lh-copy">
    <dt class="fw7">Posted on:</dt>
    <dd class="fw5 ml0">October 25, 2024</dd>
  </dl>
  <dl class="f6 lh-copy">
    <dt class="fw7">Length:</dt>
    <dd class="fw5 ml0">9 minute read, 1736 words</dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Categories:</dt>
    <dd class="fw5 ml0"> <a href="https://johaniefournier.com/categories/rstats">rstats</a>  <a href="https://johaniefournier.com/categories/tidymodels">tidymodels</a>  <a href="https://johaniefournier.com/categories/tidytuesday">tidytuesday</a>  <a href="https://johaniefournier.com/categories/models">models</a> </dd>
  </dl>
  
  
  
  <dl class="f6 lh-copy">
    <dt class="fw7">Tags:</dt>
    <dd class="fw5 ml0"> <a href="https://johaniefournier.com/tags/rstats">rstats</a>  <a href="https://johaniefournier.com/tags/tidymodels">tidymodels</a>  <a href="https://johaniefournier.com/tags/tidytuesday">tidytuesday</a>  <a href="https://johaniefournier.com/tags/models">models</a> </dd>
  </dl>
  
  <dl class="f6 lh-copy">
    <dt class="fw7">See Also:</dt>
    
    <dd class="fw5 ml0"><a href="/blog/tyt2025w19/">TyT2025W19: Seismic Events at Mount Vesuvius</a></dd>
    
    <dd class="fw5 ml0"><a href="/blog/ca_temperature_viz2/">Heatmap to Visualize Spatio-Temporal Data</a></dd>
    
    <dd class="fw5 ml0"><a href="/blog/ca_temperature_viz/">Side by side interactive map with {leaflet} and {leaflet.extras2}</a></dd>
    
  </dl>
</details>

      </section>
      <footer class="post-footer">
        <div class="post-pagination dt w-100 mt4 mb2">
  
  
    <a class="prev dtc pr2 tl v-top fw6"
    href="https://johaniefournier.com/blog/tyt2024w21_viz/">&larr; TyT2024W21 - VIZ:Carbon Majors Emissions Data</a>
  
  
  
    <a class="next dtc pl2 tr v-top fw6"
    href="https://johaniefournier.com/blog/tyt2024w21_eda/">TyT2024W21 - EDA:Carbon Majors Emissions Data &rarr;</a>
  
</div>

      </footer>
    </article>
    
      
<div class="post-comments pa0 pa4-l mt4">
  
  <script src="https://utteranc.es/client.js"
          repo="jofou/johaniefournier.com"
          issue-term="title"
          theme="github-light"
          label="comments :speech_balloon:"
          crossorigin="anonymous"
          async
          type="text/javascript">
  </script>
  
</div>

    
  </section>
</main>
<footer class="site-footer pv4 bt b--transparent ph5" role="contentinfo">
  <nav class="db dt-l w-100">
    <p class="site-copyright f7 db dtc-l v-mid w-100 w-33-l tc tl-l pv2 pv0-l mv0 lh-copy">
      &copy; 2025 Johanie Fournier
      <span class="middot-divider"></span>
      Made with <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/hugo-apero/" rel="dct:source">Hugo Apéro</a></span>.
      <br />
      
Based on <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"><a xmlns:dct="http://purl.org/dc/terms/" href="https://github.com/formspree/blogophonic-hugo" rel="dct:source">Blogophonic</a></span> by <a xmlns:cc="http://creativecommons.org/ns#" href="https://formspree.io" property="cc:attributionName" rel="cc:attributionURL">Formspree</a>.
    </p>
    
    <div class="site-links f6 db dtc-l v-mid w-100 w-67-l tc tr-l pv2 pv0-l mv0">
      
      <a class="dib pv1 ph2 link" href="/license/" title="License">License</a>
      
    </div>
  </nav>
  
    <script>

    var i, text, code, codes = document.getElementsByTagName('code');
    for (let i = 0; i < codes.length;) {
      code = codes[i];
      if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
        text = code.textContent;
        if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
          text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
          code.textContent = text;
        }
        if (/^\\\((.|\s)+\\\)$/.test(text) ||
            /^\\\[(.|\s)+\\\]$/.test(text) ||
            /^\$(.|\s)+\$$/.test(text) ||
            /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
          code.outerHTML = code.innerHTML;  
          continue;
        }
      }
      i++;
    }
</script>

  
    
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>



    
  
  
</footer>


<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#2D2D39"
    },
    "button": {
      "background": "#14a7d0"
    }
  },
  "theme": "edgeless",
  "position": "bottom-right",
  "content": {
      "message": "This website uses cookies for Google Analytics so that I know how many people are reading the blog and which blogposts are the most popular. The website does not collect any personal data.",
  "href": "https://www.cookiesandyou.com/"
  }
});
</script>

      </div>
    </body>
</html>

