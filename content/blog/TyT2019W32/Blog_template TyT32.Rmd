---
title: "TyT2019|W32"
author: "Johanie Fournier, agr."
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: 
  html_document
---
<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE, echo=FALSE}
#install.packages("janitor")
#library(devtools)
#devtools::install_github("duncantl/XMLRPC")
#devtools::install_github("thebioengineer/tidytuesdayR")
#devtools::install_github("alasairrushworth/inspectdf")
#install.packages("extrafont")
library(extrafont)
library(janitor)
#font_import()
fonts()
library(zoo)
library(inspectdf)
library(tidytuesdayR)
library(knitr)
library(RWordPress)
library(readxl)
library(readr)
library(dplyr)
library(tidyr)
library(data.table)
library(tidyverse)
library(ggplot2)
library(ggalt)
library(magick)
library(here)
library(magrittr)
library(Hmisc)
library(patchwork)
library(bbplot)
library(ggpol)
library(lubridate)
```
Le [#Tidytuesday](https://github.com/rfordatascience/tidytuesday) de cette semaine est pour les artistes dans l'âme! On visualise la composition des oeuvres de Bob Ross créées pendant *The Joy of Painting*. Au menu, sélection des éléments les plus important à présenter et visualisation de l'évolution avec des lignes et des points.  


<br><br>
**CONTEXTE**

Les données de cette semaine sont disponible sur [Github](https://github.com/rfordatascience/tidytuesday/blob/master/data/2019/2019-08-06/bob-ross.csv) ou directement dans le [package R de 538](https://github.com/rudeboybert/fivethirtyeight). L'Article de blog qui a inspiré le sujet de cette semaine peut être conculté [ici](https://fivethirtyeight.com/features/a-statistical-analysis-of-the-work-of-bob-ross/).

Bob Ross est un artiste peintre principalement connu pour son émission télévisuelle *The Joy of Painting* initialement difusée entre 1983 et 1993. Chacun des épisodes étaient animés par Bob Ross lui-même. Dans ses épisodes, il peint des paysages souvent imaginaires, utilisant la technique du premier coup, c'est-à-dire qu'il continue de peindre avant que la couche déjà existante ne sèche.


<br><br>
**OBJECTIFS**

1) Identifier les 3 composantes les plus présentes dans ses peintures.
2) Visaliser l'évolution dans le temps (entre les saisons) de ces 3 composantes et les comparer aux reste des éléments présent dans la base de donnée. 


<br><br>
**IMPORTER**
```{r, include=TRUE, echo=TRUE, warning=FALSE,comment=FALSE}
bob_ross <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-06/bob-ross.csv")
```

<br><br>
**EXPLORER**
```{r, echo=TRUE}
glimpse(bob_ross)
```

<br><br>
Pour povoir regrouper les émissions par saisons, il va falloir travailler la colonne *episode* pour séparer la saison de l'épisode. Toutes les variables qui concernent les éléments retrouvés dans les peintures sont identifiés comme des nombres binaires prenant la valeur 0 ou 1. 

<br><br>

**PRÉPARER**: 

```{r, include=TRUE, echo=TRUE, warning=FALSE, eval=TRUE, comment=FALSE}
data<-bob_ross %>% 
  janitor::clean_names() %>% 
  separate(episode, into = c("season", "episode"), sep = "E") %>% 
  mutate(season = str_extract(season, "[:digit:]+")) %>% 
  mutate_at(vars(season, episode), as.integer) %>% 
    select(-episode, -title) %>%
  gather(-season, key = "element", value = "count") %>%
  mutate(element = case_when(.$element %in% c("lake", "lakes") ~ "lake",
                             TRUE ~ as.character(.$element))) %>% 
  mutate(element = case_when(.$element %in% c("mountain", "mountains") ~ "mountain",
                             TRUE ~ as.character(.$element))) %>% 
  mutate(element = case_when(.$element %in% c("tree", "trees", "conifer", "palm_trees", "deciduous") ~ "tree",
                             TRUE ~ as.character(.$element))) %>% 
  mutate(element = case_when(.$element %in% c("person", "portrait") ~ "portrait",
                             TRUE ~ as.character(.$element))) %>% 
  mutate(element = case_when(.$element %in% c("cloud", "cumulus") ~ "cloud",
                             TRUE ~ as.character(.$element))) %>% 
  group_by(season, element) %>% 
  summarise(count=sum(count))

#Quels sont les 3 éléments les plus importants dans les peintures:
sommaire<-data %>% 
  group_by(element) %>% 
  summarise(count=sum(count))

#Arbres: 1146
#montagnes:259
#nuages: 179

#modifier la base de données pour visualisation:
freq<-data %>% 
  mutate(element=ifelse(!element %in% c("tree", "mountain", "clouds"), "divers", element))

cat<-freq %>% 
  inspect_cat()

cat$levels$element

data_cat<-freq %>% 
  filter(element %in% c("tree", "mountain", "clouds"))

data_divers<-freq %>% 
  filter(!element %in% c("tree", "mountain", "clouds"))
```


<br><br>
**VISUALISER**

```{r, eval=FALSE}
#Graphique
gg<-ggplot(data_cat, aes(x=season, y=count, group=element, color=element))
gg <- gg + geom_point(data=data_divers,size=4, alpha=0.3, color="#AFB7BB")
gg <- gg + geom_point(data=data_cat, size=4, alpha=0.7)
gg <- gg + scale_color_manual(values=c("#266DD3", "#F6AE2D","#33673B"))
gg <- gg + geom_smooth(data=data_cat,se=FALSE, size=2)
#retirer la légende
gg <- gg + theme(legend.position = "none")
#ajuster les axes 
gg <- gg + scale_y_continuous(breaks=seq(00,50,10), limits = c(0, 50))
gg <- gg + scale_x_continuous(breaks=seq(1,31,5), limits = c(1, 33.5))
#modifier le thème
gg <- gg +  theme(panel.border = element_blank(),
                    panel.background = element_blank(),
                    plot.background = element_blank(),
                    panel.grid.major.y= element_line(size=0.2,linetype="dotted", color="#6D7C83"),
                    panel.grid.major.x= element_blank(),
                    panel.grid.minor = element_blank(),
                    axis.line.x = element_line(color="#6D7C83"),
                    axis.line.y = element_line(color="#6D7C83"),
                    axis.ticks.y = element_blank(),
                    axis.ticks.x = element_blank())
#ajouter les étiquettes de données
gg<-gg + annotate(geom="text", x=31,y=40, label="Arbre", color="#33673B", size=4, hjust=0,vjust=0, fontface="bold")
gg<-gg + annotate(geom="text", x=31,y=5, label="Nuage", color="#266DD3", size=4, hjust=0,vjust=0, fontface="bold")
gg<-gg + annotate(geom="text", x=31,y=11,  label="Montagne", color="#F6AE2D", size=4, hjust=0,vjust=0, fontface="bold")
#ajouter les titres
gg<-gg + labs(title=" ",
              subtitle="",
              y="Nombre", 
              x="Saison")
gg<-gg + theme(plot.title    = element_blank(),
                 plot.subtitle = element_blank(),
                 axis.title.y  = element_text(hjust=1, vjust=0, size=12, color="#6D7C83", face="bold"),
                 axis.title.x  = element_text(hjust=0, vjust=0, size=12, color="#6D7C83", face="bold"),
                 axis.text.y   = element_text(hjust=0.5, vjust=0, size=12, color="#6D7C83", face="bold"), 
                 axis.text.x   = element_text(hjust=0.5, vjust=0, size=12, color="#6D7C83", face="bold"))

```

```{r, include=FALSE, echo=FALSE, warning=FALSE}
aspect_ratio <-2
height <- 5
#ggsave("~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line fra.png", 
 #      height = height , width = height * aspect_ratio)

# Call back the plot
plot1 <- image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line fra.png')
#image_browse(plot1)

#Créer le titre
couleur <- image_read('~/Documents/ENTREPRISE/Projets R/couleur/FFFFFF.png')
titre<- couleur %>%
  image_scale("x20") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "1000x150") %>% 
  image_annotate("Les peintures de Bob Ross",
                 color = "black", size = 85, location = "+20+5", font='Arial Rounded MT Bold') %>% 
  image_annotate("Au fil des saisons de son émission 'The Joy of Painting', les 3 éléments qui reviennent le plus souvent dans \nses peintures sont des arbres, des montagnes et des nuages.",
                 color = "#8597A0", size = 38, location = "+20+150", font='Arial Rounded MT Bold')
#image_browse(titre)

# And bring in a logo
logo_raw<-image_read('~/Documents/ENTREPRISE/Projets R/Logo/Logo_gris_FFFFFF.png')
logo <- logo_raw %>%
  image_scale("x30") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "10x10")

couleur <- image_read('~/Documents/ENTREPRISE/Projets R/couleur/FFFFFF.png')
backgound <- couleur %>%
  image_scale("x20") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "1000x40")
  
footer<-image_composite(backgound, logo, offset="+0+50") %>% 
  image_annotate("SOURCE: FiveThirtyEight  |  DESIGN: Johanie Fournier, agr.",
                 color = "#8597A0", size = 26, gravity='northeast', location = "+10+55")
#image_browse(footer)

# Stack them on top of each other
#final_plot <- image_append(image_scale(c(titre,plot1, footer),"1000"), stack = TRUE)
#image_browse(final_plot)

# And overwrite the plot without a logo
#image_write(final_plot, '~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line fra FINAL.png')

###########################################################################################################################
####################################################Anglais################################################################
###########################################################################################################################
#Graphique
gg<-ggplot(data_cat, aes(x=season, y=count, group=element, color=element))
gg <- gg + geom_point(data=data_divers,size=4, alpha=0.3, color="#AFB7BB")
gg <- gg + geom_point(data=data_cat, size=4, alpha=0.7)
gg <- gg + scale_color_manual(values=c("#266DD3", "#F6AE2D","#33673B"))
gg <- gg + geom_smooth(data=data_cat,se=FALSE, size=2)
#retirer la légende
gg <- gg + theme(legend.position = "none")
#ajuster les axes 
gg <- gg + scale_y_continuous(breaks=seq(00,50,10), limits = c(0, 50))
gg <- gg + scale_x_continuous(breaks=seq(1,31,5), limits = c(1, 33.5))
#modifier le thème
gg <- gg +  theme(panel.border = element_blank(),
                    panel.background = element_blank(),
                    plot.background = element_blank(),
                    panel.grid.major.y= element_line(size=0.2,linetype="dotted", color="#6D7C83"),
                    panel.grid.major.x= element_blank(),
                    panel.grid.minor = element_blank(),
                    axis.line.x = element_line(color="#6D7C83"),
                    axis.line.y = element_line(color="#6D7C83"),
                    axis.ticks.y = element_blank(),
                    axis.ticks.x = element_blank())
#ajouter les étiquettes de données
gg<-gg + annotate(geom="text", x=31,y=40, label="Tree", color="#33673B", size=4, hjust=0,vjust=0, fontface="bold")
gg<-gg + annotate(geom="text", x=31,y=5, label="Cloud", color="#266DD3", size=4, hjust=0,vjust=0, fontface="bold")
gg<-gg + annotate(geom="text", x=31,y=11,  label="Mountain", color="#F6AE2D", size=4, hjust=0,vjust=0, fontface="bold")
#ajouter les titres
gg<-gg + labs(title=" ",
              subtitle="",
              y="Number", 
              x="Season")
gg<-gg + theme(plot.title    = element_blank(),
                 plot.subtitle = element_blank(),
                 axis.title.y  = element_text(hjust=1, vjust=0, size=12, color="#6D7C83", face="bold"),
                 axis.title.x  = element_text(hjust=0, vjust=0, size=12, color="#6D7C83", face="bold"),
                 axis.text.y   = element_text(hjust=0.5, vjust=0, size=12, color="#6D7C83", face="bold"), 
                 axis.text.x   = element_text(hjust=0.5, vjust=0, size=12, color="#6D7C83", face="bold"))
aspect_ratio <-2
height <- 5
#ggsave("~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line eng.png", 
#       height = height , width = height * aspect_ratio)

# Call back the plot
plot1 <- image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line eng.png')
#image_browse(plot1)

#Créer le titre
couleur <- image_read('~/Documents/ENTREPRISE/Projets R/couleur/FFFFFF.png')
titre<- couleur %>%
  image_scale("x20") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "1000x150") %>% 
  image_annotate("Bob Ross Painting",
                 color = "black", size = 85, location = "+20+5", font='Arial Rounded MT Bold') %>% 
  image_annotate("Over the seasons of his show 'The Joy of Painting', the three elements that come up most often in his\npaintings were trees, mountains and clouds.",
                 color = "#8597A0", size = 38, location = "+20+150", font='Arial Rounded MT Bold')
#image_browse(titre)

# And bring in a logo
logo_raw<-image_read('~/Documents/ENTREPRISE/Projets R/Logo/Logo_gris_FFFFFF.png')
logo <- logo_raw %>%
  image_scale("x30") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "10x10")

couleur <- image_read('~/Documents/ENTREPRISE/Projets R/couleur/FFFFFF.png')
backgound <- couleur %>%
  image_scale("x20") %>% 
  image_background("#FFFFFF", flatten = TRUE) %>%
  image_border("#FFFFFF", "1000x40")
  
footer<-image_composite(backgound, logo, offset="+0+50") %>% 
  image_annotate("SOURCE: FiveThirtyEight  |  DESIGN: Johanie Fournier, agr.",
                 color = "#8597A0", size = 26, gravity='northeast', location = "+10+55")
#image_browse(footer)

# Stack them on top of each other
#final_plot <- image_append(image_scale(c(titre,plot1, footer),"1000"), stack = TRUE)
#image_browse(final_plot)

# And overwrite the plot without a logo
#image_write(final_plot, '~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line eng FINAL.png')

```

Voici ce que ça donne:

<br><br>
```{r echo=FALSE, out.width='100%', fig.align='center'}
image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W32/line fra FINAL.png')
```
<br><br>

## CONCLUSION: 

C'est assez clair que Bob Ross a un penchant pour peindre des arbres. C'est l'élément qui est de loin le plus présent dans ses peintures. Les deux autres éléments qui se démarquent du reste du lot sont les montagnes et les arbres. 


Alors, tu veux en savoir plus sur ma démarche? Un épisode de [podcast](johaniefournier.com/category/podcast/) sera bientôt disponible dans lequel je t'explique toute la réflexion et les concepts de data visualisation qui ont menés à la création de cette viz.

