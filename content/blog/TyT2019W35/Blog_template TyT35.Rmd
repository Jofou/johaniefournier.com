---
title: "TyT2019|W35 - tvthemes: Les Simpsons"
author: "Johanie Fournier, agr."
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: 
  html_document
---
<style>
body {
text-align: justify}
</style>

```{r setup, include=FALSE, echo=FALSE}
#install.packages("tvthemes")
#devtools::install_github("Ryo-N7/tvthemes")
#library(devtools)
#devtools::install_github("duncantl/XMLRPC")
#devtools::install_github("thebioengineer/tidytuesdayR")
#devtools::install_github("alasairrushworth/inspectdf")
#install.packages("extrafont")
#install.packages("ggchicklet", repos = "https://cinc.rud.is")
library(ggchicklet)
library(extrafont)
library(janitor)
#font_import()
library(zoo)
library(inspectdf)
library(tidytuesdayR)
library(knitr)
library(RWordPress)
library(readxl)
library(readr)
library(dplyr)
library(tidyr)
library(data.table)
library(tidyverse)
library(ggplot2)
library(ggalt)
library(magick)
library(here)
library(magrittr)
library(Hmisc)
library(patchwork)
library(bbplot)
library(ggpol)
library(lubridate)
library(eeptools)
library(tvthemes)

```
Cette semaine on est transporté à Springfield Ce [#Tidytuesday](https://github.com/rfordatascience/tidytuesday) nous fait découvrir tous les invités spéciaux depuis la première saison de la populaire émission télévisée Les Simpsons. Pour illuster le tout, j'ai identifié l'invité le plus populaire et comparer son nombre d'apparition par saison coparativement aux autres invités. 

<br><br>
**CONTEXTE**

Les données de cette semaine sont disponible via [wikipedia](https://en.wikipedia.org/wiki/List_of_The_Simpsons_guest_stars). 

Dans ces données, on peut constater quels sont les invités spéciaux des 30 premières saisons. Outre la distribution régulière d'acteurs de voix de la série, des stars ont été un élément essentiel de la série télévisée d'animation américaine The Simpsons, créée par Matt Groening pour la Fox Broadcasting Company, depuis sa première saison. The Simpsons se concentre sur la famille éponyme, qui comprend Homer, Marge, Bart, Lisa et Maggie. 

Les voix des invités proviennent d'un large éventail de professions, notamment les acteurs, les athlètes, les auteurs, les musiciens, les artistes, les politiciens et les scientifiques. Dans les premières années de la série, la plupart des invités ont exprimé des personnages originaux, mais à mesure que la série se poursuivait, le nombre de personnes apparaissant comme telles a augmenté.

<br><br>
**OBJECTIFS**

1) Identifier l'invité qui est présent le plus souvent.
2) Visualiser l'évolution dans le temps (au travers des saisons) de l'apparition de cet invité le plus populaire et le comparer avec le total des autres invités présents. 
3) Utiliser les éléments estéthiques des Simpsons pour monter le visuel


<br><br>
**IMPORTER**
```{r, include=TRUE, echo=TRUE, warning=FALSE,comment=FALSE}
simpsons <- readr::read_delim("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-08-27/simpsons-guests.csv", delim = "|", quote = "")
```

<br><br>
**EXPLORER**
```{r, echo=TRUE}
summary(simpsons)
```
Les saisons sont stockés sous forme de texte, il faut modifier le format pour créer un graphique. Toutes les informations nécessaire sont déjà dans la base de donnée.

<br><br>

**PRÉPARER** 

```{r, include=TRUE, echo=TRUE, warning=FALSE, eval=TRUE, comment=FALSE}
#Combien y a-t-il de saison?
inspect_season<-simpsons %>%
   inspect_cat()
season<-inspect_season$levels$season %>% 
  filter(!value=="Movie") %>%
 mutate(value=as.numeric(value)) 
#aucune données pour les saisons 15 et 20

#Identifier l'acteur qui revient le plus souvent dans tous les épisodes
simpsons_freq <- simpsons %>%
  inspect_cat()
acteur<-simpsons_freq$levels$guest_star 
#Marcia Wallace

simpsons_cat <- simpsons %>% 
 mutate(season=as.numeric(season)) %>% 
 mutate(acteur=ifelse(guest_star %in% c("Marcia Wallace"),"Marcia Wallace","Autre")) %>% 
 group_by(season, acteur) %>% 
 summarise(nb=dplyr::n()) %>% 
 filter(!season %in% NA) %>% 
 spread(acteur, nb) %>% 
 mutate(`Marcia Wallace`=ifelse(is.na(`Marcia Wallace`), 0, `Marcia Wallace`)) %>% 
 mutate(pct_Marcia=`Marcia Wallace`/(`Marcia Wallace`+Autre)*100) %>% 
 mutate(pct_autre=Autre/(`Marcia Wallace`+Autre)*100) %>% 
 select(season,pct_Marcia,pct_autre) %>% 
 gather(acteur, pourcentage, -season) %>% 
 ungroup() %>% 
 add_row(season=15, acteur="pct_autre", pourcentage=100) %>% 
 add_row(season=20, acteur="pct_autre", pourcentage=100)

#Pour mettre les étiquettes de données seulement sur les valeurs concernant Marcia Wallace
simpson_MW<-simpsons_cat %>% 
  filter(acteur=="pct_Marcia") %>% 
  mutate(pourcentage=ifelse(pourcentage==0, NA, pourcentage))
```


<br><br>
**VISUALISER**

```{r, eval=FALSE}
#Graphique
#loadfonts()
gg<-ggplot(simpsons_cat, aes(x=season, y=pourcentage, group=acteur, fill=acteur))
gg <- gg + geom_bar(stat="identity", position="stack", width=0.80,color="#FEE8C8", fill="#7199E1" )
gg <- gg + geom_bar(data=simpson_MW, aes(x=season, y=pourcentage, group=acteur, fill=acteur),stat="identity", position="stack", width=0.85,color="#FEE8C8", fill="#FEE8C8")
#ajouter les étiquettes de données
gg<-gg + geom_text(data=simpson_MW, aes(x=season, y=pourcentage, label=paste0(round(simpson_MW$pourcentage,0),"%", sep="")),
                     color="#46732EFF", size=3, position = position_stack(vjust = 0.5), family="Akbar", fontface="bold")
gg<- gg + coord_flip()
#retirer la légende
gg <- gg + theme(legend.position = "none")
#ajuster les axes 
gg <- gg + scale_y_continuous(breaks=seq(0,100,100), limits = c(0, 103), expand = c(0, 0), labels = function(x) paste0(x, "%"))
gg <- gg + scale_x_continuous(breaks=seq(1,30,1), limits = c(0, 31), expand = c(0, 0))
#modifier le thème
gg <- gg +  theme(panel.border = element_blank(),
                    panel.background = element_rect(fill="#7199E1"),
                    plot.background = element_rect(fill ="#7199E1"),
                    panel.grid.major.x= element_blank(),
                    panel.grid.major.y= element_blank(),
                    panel.grid.minor = element_blank(),
                    axis.line.x = element_blank(),
                    axis.line.y = element_blank(),
                    axis.ticks.y = element_blank(),
                    axis.ticks.x = element_blank())
#ajouter les titres
gg<-gg + labs(title="Les Simpsons: Est-ce que vous aimez Edna?",
              subtitle="\nMarcia Wallace est l'actrice qui est invitée le plus souvent dans cette\ntélésérie. Elle est présente dans 13% des épisodes. Au cours des saisons,\nsa présence varie. Elle à augmenté jusqu'à 27% de la 1ère à la 9ème\nsaison pour dimunuer à 9% à la 25ème saison, soit la derière saison\navant son décès. ",
              x="Saisons", 
              y=" ", 
              caption="SOURCE:  Wikipedia  |  DESIGN: Johanie Fournier, agr.")
gg<-gg + theme(plot.title      = element_text(size=20, hjust=0,vjust=0, face="bold", family="Akbar", color="#fed90f"),
                 plot.subtitle = element_text(size=12, hjust=0,vjust=0, family="Akbar", color="#46732EFF"),
                 plot.caption =  element_text(size=8, hjust=1,vjust=0, family="Akbar", color="#D1C19E"),
                 axis.title.y  = element_text(size=10, hjust=1,vjust=0.5, family="Akbar", color="#FEE8C8"),
                 axis.title.x  = element_blank(),
                 axis.text.x   = element_text(size=10, hjust=0.5,vjust=0.5, family="Akbar", color="#FEE8C8"), 
                 axis.text.y   = element_text(size=10, hjust=0.5,vjust=0.5, family="Akbar", color="#FEE8C8"))
```

```{r, include=FALSE, echo=FALSE, warning=FALSE}
aspect_ratio <-0.81
height <- 8
ggsave("~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W35/fra.png", 
       height = height , width = height * aspect_ratio)

# Call back the plot
plot1 <- image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W35/fra.png')
image_browse(plot1)
```


```{r, include=FALSE, echo=FALSE, warning=FALSE}
###########################################################################################################################
####################################################Anglais################################################################
###########################################################################################################################
```

```{r, include=FALSE, echo=FALSE, warning=FALSE}
#Graphique 1: 
#loadfonts()
gg<-ggplot(simpsons_cat, aes(x=season, y=pourcentage, group=acteur, fill=acteur))
gg <- gg + geom_bar(stat="identity", position="stack", width=0.80,color="#FEE8C8", fill="#7199E1" )
gg <- gg + geom_bar(data=simpson_MW, aes(x=season, y=pourcentage, group=acteur, fill=acteur),stat="identity", position="stack", width=0.85,color="#FEE8C8", fill="#FEE8C8")
#ajouter les étiquettes de données
gg<-gg + geom_text(data=simpson_MW, aes(x=season, y=pourcentage, label=paste0(round(simpson_MW$pourcentage,0),"%", sep="")),
                     color="#46732EFF", size=3, position = position_stack(vjust = 0.5), family="Akbar", fontface="bold")
gg<- gg + coord_flip()
#retirer la légende
gg <- gg + theme(legend.position = "none")
#ajuster les axes 
gg <- gg + scale_y_continuous(breaks=seq(0,100,100), limits = c(0, 103), expand = c(0, 0), labels = function(x) paste0(x, "%"))
gg <- gg + scale_x_continuous(breaks=seq(1,30,1), limits = c(0, 31), expand = c(0, 0))
#modifier le thème
gg <- gg +  theme(panel.border = element_blank(),
                    panel.background = element_rect(fill="#7199E1"),
                    plot.background = element_rect(fill ="#7199E1"),
                    panel.grid.major.x= element_blank(),
                    panel.grid.major.y= element_blank(),
                    panel.grid.minor = element_blank(),
                    axis.line.x = element_blank(),
                    axis.line.y = element_blank(),
                    axis.ticks.y = element_blank(),
                    axis.ticks.x = element_blank())
#ajouter les titres
gg<-gg + labs(title="The Simpsons: Do you like Edna?",
              subtitle="\nMarcia Wallace is the actress who is invited most often in this series. She\nis present in 13% of the episodes. During the seasons, her presence varies.\nIt has increased to 27% from the 1st to the 9th season to decrease to\n9% in the 25th season, the last season before her death.",
              x="Seasons", 
              y=" ", 
              caption="SOURCE:  Wikipedia  |  DESIGN: Johanie Fournier, agr.")
gg<-gg + theme(plot.title      = element_text(size=27, hjust=0,vjust=0, face="bold", family="Akbar", color="#fed90f"),
                 plot.subtitle = element_text(size=12, hjust=0,vjust=0, family="Akbar", color="#46732EFF"),
                 plot.caption =  element_text(size=8, hjust=1,vjust=0, family="Akbar", color="#D1C19E"),
                 axis.title.y  = element_text(size=10, hjust=1,vjust=0.5, family="Akbar", color="#FEE8C8"),
                 axis.title.x  = element_blank(),
                 axis.text.x   = element_text(size=10, hjust=0.5,vjust=0.5, family="Akbar", color="#FEE8C8"), 
                 axis.text.y   = element_text(size=10, hjust=0.5,vjust=0.5, family="Akbar", color="#FEE8C8"))
```

```{r, include=FALSE, echo=FALSE, warning=FALSE}
aspect_ratio <-0.81
height <- 8
ggsave("~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W35/eng.png", 
       height = height , width = height * aspect_ratio)

# Call back the plot
plot1 <- image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W35/eng.png')
image_browse(plot1)
```


Voici ce que ça donne:

<br><br>
```{r echo=FALSE, out.width='100%', fig.align='center'}
image_read('~/Documents/ENTREPRISE/Projets R/Tidytuesday/TyT2019/W35/fra.png')
```
<br><br>


**CONCLUSION**

La présence de Marcia Wallace varie dans le temps et je pense que la meilleure façon de bien représenter ces variations est de le faire avec un histogramme.

<br><br>

Alors, tu veux en savoir plus sur ma démarche? Un épisode de [podcast](johaniefournier.com/category/podcast/) sera bientôt disponible dans lequel je t'explique toute la réflexion et les concepts de data visualisation qui ont menés à la création de cette viz.

